
name: POC | MCK
on:      
  workflow_dispatch:
    inputs:
      release-version:
        description: 'TAG_NUMBER'
        required: true
        type: choice
        default: "lynx-web-0.1020.release_lynx-RELEASE_6.13.4"
        options:
          - mvn-project-master-2023-12-04-080835-580
          - mvn-project-releases-1.1.0-2023-12-04-080835-582
          - mvn-project-releases-1.6.0-2023-12-04-080835-583
          - mvn-project-releases-3.1.0-2023-12-04-080835-584
      restart-controllers:
        type: boolean
        required: true
        default: false
      database-update:
        description: 'Select the environment if a database update needed. If not then select "false".'
        type: choice
        required: false
        default: 'false'
        options:
        - 'false'
        - LMDA
        - LMDB
        - LMDC

env:
  TAG_NUMBER: "${{ github.event.inputs.release-version }}"
  DATABASE_UPDATE: "${{ github.event.inputs.database-update }}"
  ENV: "${{ github.event.inputs.deploy-environment }}"
  PROJECT_NAME: "mvn-project"

jobs:
  First_Workflow:
    name: "Test"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Running Commands
        if: ${{ github.event.inputs.restart-controllers == 'true' }} || ${{ github.event.inputs.database-update != 'false' }}
        run: |
          set -ex
          echo $PROJECT_NAME
          input="${{ env.TAG_NUMBER}}"
          if [[ $input =~ ^$PROJECT_NAME-(.*?)-([0-9]{4})-([0-9]{2})-([0-9]{2})-([0-9]{6})-([0-9]+) ]]; then
            BRANCH_NAME="${BASH_REMATCH[1]}"
            echo $BRANCH_NAME
            releaseNumber=$(echo "${BASH_REMATCH[1]}" | cut -d- -f 2)
            echo "releaseNumber=`echo ${releaseNumber}`" >> $GITHUB_ENV  
          fi
          echo $releaseNumber
          # bash ./test.sh $releaseNumber
          


